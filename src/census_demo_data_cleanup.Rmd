---
title: "Untitled"
author: "Christina Kim"
date: "9/26/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, cache.lazy = FALSE)

library("tidyverse")
library('here')
library('janitor')

library('scales')
```

## Import Census Data

Data downloaded from the Census website at https://data.census.gov/cedsci/table?q=Housing%20Units%20in%20the%20United%20States&t=Housing%3AHousing%20Units%3APopulations%20and%20People%3ARace%20and%20Ethnicity&g=0400000US06.050000&y=2019&tid=ACSDP1Y2019.DP05&tp=true&hidePreview=true

```{r import_data}
data <- read.csv(here("data/census-demographics", "ACSDP1Y2019.DP05_data_with_overlays_2020-09-26T140825.csv"), header = TRUE)
```

Original data set has two rows of column headings, one for the codes, one for more readable names.

```{r review_data}
dim(data)
colnames(data)
str(data)
View(data)
```

Import the data set but skip the first row of code values.

```{r reimport_data_skip_1}
data_skip1 <- read_csv(here("data/census-demographics", "ACSDP1Y2019.DP05_data_with_overlays_2020-09-26T140825.csv"), skip = 1) %>% 
  clean_names()

data_skip1 %>% 
  colnames()
```

Clean up the data to rename columns and select only potentially useful columns.

Note: The 1977 OMB Race and Ethnic standards maintain that ethnicity (“Hispanic” or “Not Hispanic”) is a separate and distinct concept from race (“White,” “Black,” “American Indian or Alaskan Native,” or “Asian or Pacific Islander”.) Therefore individuals who are Hispanic may be of any Race. https://www2.census.gov/about/training-workshops/2018/2018-01-24-clmso-pres.pdf?

```{r}
data_skip1 %>% 
  # Remove margin of error values
  select(-contains("margin_of_error")) %>% 
  select(id, geographic_area_name,
         -contains("_1"),
         # Remove age fields
         !contains("_years") &
         !contains("voting_age") &
         # Include sex information
         matches("sex_and_age_.*male$") |
         # Include the Hispanic of Latino category for race and ethnicity (i.e., drop the "Race" category)
         ends_with("hispanic_or_latino_of_any_race") |
         ends_with("_alone") |
         ends_with("not_hispanic_or_latino_two_or_more_races"),
         # Remove sum rows (duplicate of other more detailed rows)
         # !contains("_1"),
         # Include housing unit count information in case it's helpful for housing analysis
         estimate_total_housing_units
         ) %>% 
  # Clean up the county column
  rename(county = geographic_area_name) %>% 
  mutate(county = str_remove(county, ", California")) %>% 
  filter(!county == "United States") %>% 
  rename_with(~ str_remove_all(.x, "(_sex_and_age|_hispanic_or_latino_and_race)_total_population|_alone|_of_any_race|_not_hispanic_or_latino|_or_african_american") %>% 
                str_replace("american_indian_and_alaska_native", "native_american") %>% 
                str_replace("native_hawaiian_and_other_pacific_islander", "pacific_islander")
              ) %>%
  mutate(estimate_other_races = estimate_some_other_race + estimate_two_or_more_races,
         percent_other_races = percent_some_other_race + percent_two_or_more_races,
         .before = estimate_total_housing_units) %>% 
  mutate(across(contains("percent"), ~ .x / 100)) %>% 
  select(-contains("some_other_race"), -contains("two_or_more_races")) %>% 
  write_csv(here("data/census-demographics", "county_sex_race_housing_units.csv"))


```


